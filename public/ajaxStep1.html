<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>api server 만들어보기</title>
    <script src="./js/handlebar.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>
<body>
    <div id="languageMenu">
    </div> 
    <div id="languageSearchResult">
    </div>        
</body>

<script>

// 예시 관련 내용 히스토리
// 초기에 해당 부분을 만들 때는 상품 목록 불러오는 부분과
// 지오로케이션 api 사용하여 현재 위치의 위도, 경도 값을 받아서 현재 위치 날씨 정보를 가져오는 페이지
// 의 예시를 구상하였으나 날씨 정보를 가져오는 외국 사이트 api에서 한국의 위도, 경도에 대한 정보가
// 정확하지 않아서 기본 메뉴에 들어가는 language데이터, 그리고 해당 랭기지에 대한 
// 해커뉴스의 검색 결과를 가져 오는 것으로 변경 하였다.

//    $.getJSON('/product/all',function(data) {
//        console.log(data[0].key);
//    }).then();

// 메뉴 리스트를 가져오는 json -> local server api ( v )
// ??? json -> external server api
// 로딩바 이미지 사용하여 >> 데이터를 불러오고 있을 때
// 비동기적으로 데이터를 가져오는 예시를 보여주기 위함.
// 데이터를 가지고 오는 함수
// 프라미스 패턴 사용, 사용 안한 예제
// jQuery ajax를 사용한 예제
// jQuery ajax를 사용하지 않은 예제
// 크로스도메인 이슈 발생하는 예제
// html5에서 제공하는 지오로케이션 api를 사용하여 현재 위치의 위도, 경도값을 받아서 현재 위치 날씨 정보를 가져오는 페이지 제작
// 한국꺼를 제공하지 않는다면 , 



var api = function(url, cb, err) {
    var req=new XMLHttpRequest();
    req.open('GET',url);
    req.send();
    req.onreadystatechange=function(e) {
        if(req.readyState===XMLHttpRequest.DONE) {
            if(req.status ===200) {
                cb(req.responseText);
            } else {
                err('Error!');
            }
        }
    };
};

var loadMenu=function(ret) {
    ret = JSON.parse(ret);
    var source = $("#languageMenuTmpl").html();
    var template = Handlebars.compile(source);
    $('#languageMenu').append(template(ret));
};

var apiError=function(err) {
    console.log(err);
};

api("./js/menu.json",loadMenu,apiError);
</script>

<script id="languageMenuTmpl" type="text/x-handlebars-template">
    <ul class="wrap_menu">
        {{#items}}  
            {{menuName}}     
        {{/items}}
    </ul>
</script>
<script id="languageSearchResultTmpl" type="text/x-handlebars-template">
    <div class="wrap_card">
            <div class="wrap_tit">
                <div class="tit_card">
                    <a href="https://code.facebook.com/posts/1840075619545360" class="link_card">
                        Yarn – A new package manager for <em>JavaScript</em>
                    </a>
                </div>
            </div>                
            <div class="wrap_date">
                <span class="txt_date">2016-10-11</span>
            </div>
            <div class="wrap_tags">
                <ul class="wrap_item">
                    <li>story</li>
                    <li>author_cpojer</li>
                    <li>story_12684980</li>
                </ul>
            </div>
    </div>
</script>

  </body>
</html>